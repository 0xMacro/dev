<page title="Trim REPL" layout>

<link rel="stylesheet" type="text/css" href="./repl.css">

<div class="h-screen flex flex-col">
  <div class="px-5 p-2 flex bg-output space-x-5">
    <h1 class="font-mono-brand">Trim REPL</h1>
    <p>1 byte = 8 bits = 2 hex chars</p>
    <p>1 evm word = 32 bytes</p>
    <div class="flex-1"></div>
    <select id="languageSelect" onchange="update()">
      <option value="trim">Trim</option>
      <option value="basm">Bare Assembly</option>
    </select>
  </div>

  <div class="flex-1 flex flex-col">
    <div class="flex-1 flex">
      <!-- Left side -->
      <div class="flex-1 flex flex-col">
        <textarea oninput="update()" id="input" class="repl-input flex-1 flex-shrink-0">
(SUB CODESIZE #runtime)
DUP1
(CODECOPY 0x00 #runtime _)
(RETURN 0x00 _)

#runtime
(CALLDATACOPY 0x1c 0x00 0x04)
(MLOAD 0x00) ; copy function id onto the stack

(EQ (abi/function-id "greet()") DUP1)
(JUMPI #greet _)

REVERT ; No matching function id

#greet
JUMPDEST
(MSTORE 0x00 "Hello, world!")
(RETURN 0x00 0x20)
        </textarea>
        <pre id="errorOutput" class="p-5 mx-[1px] pre-output sticky bottom-0 bg-output" style="display: none"></pre>
      </div>

      <!-- Right side -->
      <div class="bg-output" style="width: 60%">
        <div class="ml-5 bg-white dark:bg-cool-gray-600" style="padding: 1em;">
          Contract Create
        </div>
        <pre id="outputCreate" class="p-5 pre-output"></pre>

        <div class="ml-5 bg-white dark:bg-cool-gray-600" style="padding: 1em;">
          <div class="flex items-center space-x-2">
            <div class="pr-2 border-r">Call 1</div>
            <label class="text-sm font-mono">ABI</label>
            <input oninput="update()" type="text" id="calldataABI" value="greet()" class="bg-output p-2 font-mono">
            <label class="text-sm font-mono">Args</label>
            <input oninput="update()" type="text" id="calldataInput" value="[]" class="bg-output p-2 font-mono">
          </div>
        </div>
        <pre id="outputCall" class="p-5 pre-output"></pre>

        <div class="ml-5 bg-white dark:bg-cool-gray-600" style="padding: 1em;">
          <div class="flex items-center space-x-2">
            <div class="pr-2 border-r">Call 2</div>
            <label class="text-sm font-mono">ABI</label>
            <input oninput="update()" type="text" id="calldataABI2" value="setGreeting(string)" class="bg-output p-2 font-mono">
            <label class="text-sm font-mono">Args</label>
            <input oninput="update()" type="text" id="calldataInput2" value='["Updated!"]' class="bg-output p-2 font-mono">
          </div>
        </div>
        <pre id="outputCall2" class="p-5 pre-output"></pre>
      </div>
    </div>

    <div>
      <div class="p-2 flex-1">Scratch Converter</div>
      <div style="display: flex">
        <textarea oninput="updateScratch()" id="scratchInput" class="repl-input p-4 flex-1 outline-none"></textarea>
        <div style="width: 60%">
          <div class="px-5">
            <select id="decompileFormatSelect" onchange="updateScratch()" class="input">
              <option value="bytecode">Decompile EVM Bytecode</option>
              <option value="utf8">Hex to UTF-8</option>
              <option value="hex">UTF-8 to Hex</option>
            </select>
          </div>
          <pre id="scratchOutput" class="pre-output p-5 overflow-x"></pre>
        </div>
      </div>
    </div>

    <div>
      <div class="p-2 flex-1">Hex Padder</div>
      <div style="display: flex">
        <textarea oninput="updateHex()" id="hexInput" class="repl-input p-4 flex-1 outline-none"></textarea>
        <div style="width: 60%">
          <div class="px-5">
            Pad <input type="text" id="hexPadInput" oninput="updateHex()" value="32" style="width: 3em" class="mx-1 text-center"> bytes
          </div>
          <pre id="hexOutput" class="pre-output p-5 overflow-x"></pre>
        </div>
      </div>
    </div>

  </div>
</div>

<script type="module" src="./repl.ts"></script>
